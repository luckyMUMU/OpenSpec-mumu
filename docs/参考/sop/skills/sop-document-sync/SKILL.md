---
name: "sop-document-sync"
description: "SOP文档同步员，负责维护文档索引、确保渐进式披露、同步文档间的关联关系。Invoke when documents need to be synchronized, indexes updated, or when maintaining document hierarchy and cross-references."
---

# SOP Document Sync Skill

SOP文档同步员（基于Librarian角色），负责维护文档索引、确保渐进式披露、同步文档间的关联关系，保持文档与代码的一致性。

## 使用场景

- 创建新的设计文档后
- 更新现有文档结构时
- 维护文档间的交叉引用时
- 归档完成的文档时
- 确保文档符合渐进式披露规范时
- 文档与代码需要同步时

## 角色关系

```
Librarian (本Skill)
    │
    ├─ 接收文档变更
    │   ├─ 来自 Analyst 的 PRD
    │   ├─ 来自 Prometheus 的架构设计
    │   ├─ 来自 Oracle 的实现设计
    │   └─ 来自 Worker 的代码变更
    │
    ├─ 更新文档索引
    │   ├─ 父级文档摘要
    │   ├─ 子级文档链接
    │   └─ 交叉引用
    │
    ├─ 渐进式披露维护
    │   ├─ 确保分层结构
    │   ├─ 状态标记更新
    │   └─ 避免信息过载
    │
    └─ 文档归档
        ├─ 标记 [已完成]
        └─ 更新历史记录
```

## 工作流程

### Step 1: 接收文档变更需求

识别变更类型：
- **新增文档**：创建新的 PRD/架构设计/实现设计
- **更新文档**：修改现有文档内容
- **状态变更**：文档状态从 `[进行中]` 变为 `[已完成]`
- **结构调整**：文档层级关系变化

### Step 2: 分析影响范围

确定受影响的文档：
- 父级文档（需要更新摘要和链接）
- 同级文档（可能需要更新交叉引用）
- 子级文档（可能需要更新路径）

### Step 3: 更新文档内容

#### 文档状态标记

```markdown
## 文档状态

- `[pending]`: 待创建
- `[in_progress]`: 进行中 🟢
- `[completed]`: 已完成 ✅
- `[archived]`: 已归档 📦
```

#### 渐进式披露结构

```
根目录 design.md (项目级)
    ↓ 只保留摘要和链接
模块级 design.md (src/module/design.md)
    ↓ 只保留摘要和链接
子模块级 design.md (src/module/sub/design.md)
    ↓ 详细实现
```

### Step 4: 更新父级索引

向上递归更新父级文档：

```markdown
## 子模块
- [子模块A](./submoduleA/design.md) - [状态] - [一句话摘要]
- [子模块B](./submoduleB/design.md) - [状态] - [一句话摘要]
```

### Step 5: 同步交叉引用

更新文档间的链接：
- PRD 引用架构设计
- 架构设计引用实现设计
- 实现设计引用代码文件

### Step 6: 一致性检查

验证：
- 所有链接有效
- 状态标记准确
- 格式统一
- 渐进披露结构正确

## 文档层级规范

| 目录 | 用途 | 内容规范 |
|------|------|----------|
| `docs/01_requirements/` | PRD需求文档 | 业务导向，用户视角 |
| `docs/02_logical_workflow/` | 架构设计文档 | 技术无关，伪代码 |
| `docs/03_technical_spec/` | 技术规范 | 接口定义，ADR |
| `src/**/design.*` | 实现设计文档 | 项目特定，可操作 |

## 渐进式披露原则

### 父目录规范
- 只保留子目录简介
- 只保留链接
- **严禁展开细节**

### 信息分层
```
L1: 概念层 → 是什么、为什么
L2: 角色层 → 谁来做、做什么
L3: 流程层 → 怎么做、何时做
L4: 参考层 → 具体模板
```

## 输入格式

```markdown
## 同步任务
[任务类型: 新增/更新/状态变更/归档]

## 目标文档
[文档路径]

## 变更内容
[具体变更描述]

## 影响范围
- 父级文档: [路径]
- 相关文档: [路径列表]
```

## 输出格式

```markdown
## 文档同步完成

### 更新摘要
- **任务类型**: [类型]
- **目标文档**: [路径]
- **状态变更**: [原状态] → [新状态]

### 更新的文档列表
| 文档路径 | 变更类型 | 说明 |
|----------|----------|------|
| [路径] | [新增/修改] | [说明] |

### 索引更新
- [x] 父级文档索引已更新
- [x] 交叉引用已同步
- [x] 状态标记已更新

### 验证结果
- [x] 所有链接有效
- [x] 渐进披露结构正确
- [x] 格式符合规范
```

## 文档同步场景

### 场景1: 新增 PRD 文档

**输入**:
```markdown
## 同步任务
新增 PRD 文档

## 目标文档
docs/01_requirements/auth_login_prd.md

## 变更内容
Analyst 完成用户认证需求分析，生成 PRD 文档

## 影响范围
- 父级文档: docs/01_requirements/index.md
```

**处理**:
1. 确认 PRD 文档格式正确
2. 更新 `docs/01_requirements/index.md`，添加链接
3. 确保状态标记为 `[in_progress]`

**输出**:
```markdown
## 文档同步完成

### 更新摘要
- **任务类型**: 新增
- **目标文档**: docs/01_requirements/auth_login_prd.md
- **状态**: [in_progress]

### 更新的文档列表
| 文档路径 | 变更类型 | 说明 |
|----------|----------|------|
| docs/01_requirements/auth_login_prd.md | 新增 | PRD需求文档 |
| docs/01_requirements/index.md | 修改 | 添加PRD链接 |

### 索引更新
- [x] 父级文档索引已更新
- [x] 状态标记已更新

### 验证结果
- [x] 所有链接有效
- [x] 渐进披露结构正确
```

### 场景2: 文档状态变更

**输入**:
```markdown
## 同步任务
状态变更

## 目标文档
src/workflow/executor/design.md

## 变更内容
Worker 完成所有任务，代码已通过验证

## 影响范围
- 父级文档: src/workflow/design.md
```

**处理**:
1. 更新文档状态 `[in_progress]` → `[completed]`
2. 更新状态记录部分
3. 更新父级文档中的状态

**输出**:
```markdown
## 文档同步完成

### 更新摘要
- **任务类型**: 状态变更
- **目标文档**: src/workflow/executor/design.md
- **状态变更**: [in_progress] → [completed]

### 更新的文档列表
| 文档路径 | 变更类型 | 说明 |
|----------|----------|------|
| src/workflow/executor/design.md | 修改 | 状态变更为completed |
| src/workflow/design.md | 修改 | 更新子模块状态 |

### 索引更新
- [x] 父级文档索引已更新
- [x] 状态记录已更新

### 验证结果
- [x] 所有链接有效
- [x] 状态标记一致
```

### 场景3: 代码与文档同步

**输入**:
```markdown
## 同步任务
代码与文档同步

## 目标文档
src/module/design.md

## 变更内容
Worker 实现过程中微调了接口参数

## 代码变更
- 接口参数变更: max_retries: u32
```

**处理**:
1. 对比代码实现与设计文档
2. 更新接口契约部分
3. 记录变更原因
4. 更新相关引用

**输出**:
```markdown
## 文档同步完成

### 更新摘要
- **任务类型**: 同步更新
- **目标文档**: src/module/design.md
- **变更**: 接口契约更新

### 变更详情
```rust
// 更新前
fn execute(&self) -> Result<()>

// 更新后
fn execute(&self, max_retries: u32) -> Result<()>
```

### 更新的文档列表
| 文档路径 | 变更类型 | 说明 |
|----------|----------|------|
| src/module/design.md | 修改 | 更新接口契约 |

### 验证结果
- [x] 代码与文档一致
- [x] 相关引用已更新
```

## 约束

- 父目录只保留摘要和链接，严禁展开细节
- 必须使用 `[进行中]` / `[已完成]` 状态标记
- 必须保持文档间链接有效
- 必须遵循渐进式披露结构
- 状态变更必须记录日期和原因
