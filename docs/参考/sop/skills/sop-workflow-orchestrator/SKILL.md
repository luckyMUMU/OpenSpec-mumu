---
name: "sop-workflow-orchestrator"
description: "SOP工作流编排器，负责任务分诊、角色调度和流程管理。Invoke when receiving a new task request to determine the appropriate workflow path and assign roles."
---

# SOP Workflow Orchestrator Skill

SOP工作流编排器，基于AI项目通用规约负责任务分诊、角色调度和流程管理。

## 使用场景

- 接收用户任务请求时
- 需要判断任务复杂度时
- 需要选择处理路径时（快速路径/深度路径）
- 需要分配AI角色时

## 角色关系

```
Router (本Skill)
    │
    ├─ 快速路径 → Explorer → Worker → Librarian
    │
    └─ 深度路径 → Analyst → Prometheus ↔ Skeptic → Oracle → Worker → Librarian
```

## 工作流程

### Step 1: 任务分析

分析用户请求的以下维度：

| 维度 | 问题 | 影响 |
|------|------|------|
| 范围 | 涉及多少文件？ | 单文件 vs 跨文件 |
| 复杂度 | 是否有逻辑变更？ | 配置调整 vs 功能开发 |
| 类型 | 是新增、修改还是重构？ | 路径选择 |
| 风险 | 是否影响核心功能？ | 是否需要深度设计 |

### Step 2: 路径选择

#### 快速路径 (Fast Path)

**适用条件**（满足任一）：
- 单文件修改
- 变更 < 30 行
- 无逻辑变更（配置、文档、格式）
- 纯文档更新

**流程**：
```
Explorer (快速审计) → Worker (直接修改) → Librarian (更新文档)
```

#### 深度路径 (Deep Path)

**适用条件**（满足任一）：
- 跨文件变更
- 新功能开发
- 代码重构
- API 变更
- 系统架构调整

**流程**：
```
新项目/大重构：
Analyst (需求分析) → Prometheus (架构设计) ↔ Skeptic (架构审查) → Oracle (实现设计) → Worker (编码) → Librarian (文档维护)

功能迭代：
Analyst (需求分析) → Oracle (实现设计) → Worker (编码) → Librarian (文档维护)
```

### Step 3: 角色分配

根据任务类型分配角色：

| 任务类型 | 主要角色 | 辅助角色 |
|----------|----------|----------|
| 需求分析 | Analyst | - |
| 代码审计 | Explorer | - |
| 架构设计 | Prometheus | Analyst |
| 架构审查 | Skeptic | Prometheus |
| 实现设计 | Oracle | Prometheus |
| 编码实现 | Worker | Oracle |
| 进度监管 | Supervisor | 所有角色 |
| 文档维护 | Librarian | 所有角色 |

## 输入格式

```markdown
## 任务请求
[用户原始请求]

## 上下文信息
- 项目类型: [新项目/功能迭代/代码重构]
- 相关文件: [文件列表]
- 紧急程度: [高/中/低]
- 已知约束: [约束条件]
```

## 输出格式

```markdown
## 任务分诊结果

### 路径选择
- [ ] 快速路径 (Fast Path)
- [x] 深度路径 (Deep Path)

### 理由
[选择理由说明]

### 角色分配
| 阶段 | 角色 | 任务 |
|------|------|------|
| 1 | Analyst | 需求分析 |
| 2 | Prometheus | 架构设计 |
| 3 | Skeptic | 架构审查 |
| 4 | Oracle | 实现设计 |
| 5 | Worker | 编码实现 |
| 6 | Librarian | 文档维护 |

### 预计时间
[时间估算]

### 下一步
@[角色]: [具体任务]
```

## 决策树

```
接收任务
    │
    ├─ 是纯文档更新？
    │   ├─ 是 → 快速路径
    │   └─ 否 → 继续
    │
    ├─ 是单文件且<30行且无逻辑变更？
    │   ├─ 是 → 快速路径
    │   └─ 否 → 继续
    │
    ├─ 是新功能/重构/API变更？
    │   ├─ 是 → 深度路径
    │   └─ 否 → 继续
    │
    └─ 其他 → 根据具体情况判断
```

## 示例

### 示例1: 新增功能

**输入**:
```markdown
## 任务请求
需要添加用户认证功能，支持JWT token验证

## 上下文信息
- 项目类型: 功能迭代
- 相关文件: 未知
- 紧急程度: 中
- 已知约束: 使用Rust语言，已有用户模块
```

**输出**:
```markdown
## 任务分诊结果

### 路径选择
- [ ] 快速路径
- [x] 深度路径

### 理由
新增用户认证功能涉及：
- 跨模块变更（用户模块、中间件、API）
- 安全相关功能需要充分设计
- 需要架构层面的接口定义

### 角色分配
| 阶段 | 角色 | 任务 |
|------|------|------|
| 1 | Analyst | 需求分析，生成PRD |
| 2 | Prometheus | 架构设计，定义接口 |
| 3 | Skeptic | 架构审查 |
| 4 | Oracle | 实现设计，技术选型 |
| 5 | Worker | 编码实现 |
| 6 | Librarian | 文档维护 |

### 预计时间
3-5天

### 下一步
@Analyst: 请与用户对话，挖掘认证功能的具体需求
```

### 示例2: 修改配置

**输入**:
```markdown
## 任务请求
修改数据库连接超时时间为30秒

## 上下文信息
- 项目类型: 配置调整
- 相关文件: config.yaml
- 紧急程度: 低
```

**输出**:
```markdown
## 任务分诊结果

### 路径选择
- [x] 快速路径
- [ ] 深度路径

### 理由
单文件配置调整，无逻辑变更

### 角色分配
| 阶段 | 角色 | 任务 |
|------|------|------|
| 1 | Explorer | 快速确认影响 |
| 2 | Worker | 修改配置 |
| 3 | Librarian | 更新文档 |

### 预计时间
10-30分钟

### 下一步
@Explorer: 请快速确认修改数据库超时配置的影响范围
```

## 约束

- 必须准确判断任务复杂度
- 必须考虑任务依赖关系
- 必须分配合适的角色
- 必须提供清晰的路径选择理由
- 必须给出明确的下一步指示
