# 快速路径

> **版本**: v1.4.0

**适用**: 单文件+<30行+无逻辑变更

---

## 流程

```
Explorer → Worker → Librarian
```

| 阶段 | 输入 | 输出 | 停止点 |
|------|------|------|--------|
| Explorer | 目标文件 | 审计报告 | - |
| Worker | 审计报告 | 代码修改 | Diff展示 |
| Librarian | 代码修改 | 文档更新 | `[已完成]` |

---

## 步骤

### 1. Explorer 分析
- 读取目标文件
- 识别依赖关系
- 评估风险
- **输出**: 审计报告

### 2. Worker 修改
- 建立检查点
- 执行修改
- 运行测试
- 质量检查
- **停止点**: Diff展示待审

### 3. Librarian 更新
- 更新代码注释
- 更新相关文档
- **输出**: `[已完成]`

---

## 约束

- 单文件
- <30行
- 无逻辑变更
- 测试通过

---

## 变更分类与升级红线

### 可走快速路径的变更（典型）

| 类型 | 示例 | 备注 |
|------|------|------|
| 格式/排版 | 换行、缩进、排序、lint修复 | 不改变语义 |
| 注释/文案 | 注释修正、日志文案/错误信息文案修正 | 不影响分支判断 |
| 明确的拼写/命名修复 | 变量拼写、文档链接修正 | 不涉及对外接口 |
| 无行为重构（可验证） | 提取常量、合并重复代码 | 必须可通过测试证明无行为变化 |

### 必须升级到深度路径的红线

满足任一条件即**禁止快速路径**，应转入深度路径（至少单目录）：
- 变更触及**对外接口**：函数/类/HTTP API 签名、返回结构、错误码、事件名、配置字段含义
- 变更触及**逻辑控制流**：新增/删除/修改 if/else、循环、短路条件、异常分支、重试/超时
- 变更触及**数据模型/持久化**：表结构、序列化字段、缓存键、迁移脚本、兼容策略
- 变更触及**安全边界**：鉴权/授权、密钥处理、输入校验、注入防护、权限绕过
- 变更触及**并发/一致性**：锁、事务、幂等、竞态、分布式一致性
- 变更触及**外部依赖行为**：新增依赖、升级核心依赖、改动网络调用/支付/通知等外部交互
- 变更需要**跨文件/跨目录**改动，或无法保证“单一职责的一件事”

### “无逻辑变更”快速判定清单

若出现任一项，视为存在逻辑变更（需升级）：
- 改动了任何条件表达式的运算符、比较值或布尔组合
- 新增/删除/调整了异常捕获与抛出路径
- 改动了返回值选择路径（哪怕返回值类型不变）
- 改动了 IO 相关代码（文件/网络/数据库/时间/随机数）

当无法确定是否属于逻辑变更时，默认**升级到深度路径**。
