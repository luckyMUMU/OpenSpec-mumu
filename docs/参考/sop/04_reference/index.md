# 参考文档 (Reference)

本层包含详细的模板、格式和技术规范，供各角色在具体工作中参考使用。

---

## 文档放置规则

### 目录结构规范

| 目录 | 用途 | 变更权限 |
|------|------|----------|
| `/docs` | 项目设计文档（PRD、架构、实现设计） | 项目开发过程中动态创建和更新 |
| `/docs/参考/` | SOP 参考文档、模板、规范 | **非指定不变更**，仅 Librarian 维护 |
| `/docs/01_requirements/` | PRD 需求文档 | Analyst 创建 |
| `/docs/02_logical_workflow/` | 架构设计文档 | Prometheus 创建 |
| `src/**/design.md` | 实现设计文档 | Oracle/Worker 创建 |

### design.md 创建规则

**基于模块划分**：
- 每个独立模块/能力在根目录创建 `design.md`
- 模块划分依据：功能边界、代码复杂度、团队分工

**基于复杂度判断**：
| 复杂度 | 设计文档要求 |
|--------|--------------|
| 低（<100行，单一功能） | 可省略独立 design.md，在代码注释中说明 |
| 中（100-500行，多函数） | 创建简要 design.md，包含接口契约 |
| 高（>500行，多模块交互） | 创建完整 design.md，含详细接口契约和任务清单 |

### 接口契约规范

每个模块的 `design.md` 必须包含：

```markdown
## 接口契约

### 输入
| 参数 | 类型 | 说明 |
|------|------|------|
| [param] | [type] | [description] |

### 输出
| 返回值 | 类型 | 说明 |
|--------|------|------|
| [return] | [type] | [description] |

### 依赖
- 依赖模块: [module_name]
- 依赖接口: [interface_name]
```

---

## 文档模板

### 架构设计文档
**使用角色**: Prometheus  
**用途**: 编写技术无关的架构设计

包含内容：
- 核心概念定义
- 逻辑流程伪代码
- 接口规范定义
- 架构决策记录 (ADR)

👉 [查看架构设计文档模板](./document_templates/architecture_design.md)

---

### 实现设计文档
**使用角色**: Oracle  
**用途**: 编写项目特定的实现设计

包含内容：
- 领域模型定义
- 架构映射说明
- 详细任务清单
- 接口契约定义
- 测试策略

👉 [查看实现设计文档模板](./document_templates/implementation_design.md)

---

## 交互格式

### Supervisor 报告格式
**使用角色**: Supervisor  
**用途**: 进度报告、熔断警告、决策请求

包含格式：
- 进度通知格式
- 熔断警告格式
- 决策请求格式
- 风险预警格式
- 状态汇总格式

👉 [查看 Supervisor 交互格式](./interaction_formats/supervisor_report.md)

---

## 技术规范

### 伪代码规范
**适用范围**: Prometheus 编写的架构设计

核心要点：
- 使用 `UPPER_SNAKE_CASE` 表示原子操作
- 使用 4 空格缩进表示逻辑层次
- 注释说明"为什么"而非"是什么"
- 避免特定编程语言语法
👉 规范详见 [架构设计文档模板](./document_templates/architecture_design.md)

---

### 文档规范
**适用范围**: 所有设计文档

核心要点：
- 渐进式披露结构
- 状态标记规范
- 交叉引用规则
- 版本管理规范
👉 暂无独立文档；参考 [实现设计文档模板](./document_templates/implementation_design.md) 的文档结构与质量检查清单

---

### 代码规范
**适用范围**: Worker 编写的实现代码

核心要点：
- 错误处理规范
- 日志记录规范
- 测试规范
- 质量检查规范
👉 暂无独立文档；参考 [实现设计文档模板](./document_templates/implementation_design.md) 的测试策略与质量检查清单

---

## 快速参考

### 角色与文档对应关系

| 角色 | 主要文档 | 参考文档 |
|------|----------|----------|
| Prometheus | 架构设计文档模板 | 伪代码规范 |
| Oracle | 实现设计文档模板 | 文档规范 |
| Worker | - | 代码规范 |
| Supervisor | - | 交互格式 |
| Librarian | - | 文档规范 |

### 文档选择决策树

```
需要编写设计文档？
    │
    ├─ 是 → 架构层面设计？
    │       │
    │       ├─ 是 → 使用架构设计文档模板
    │       │       (Prometheus)
    │       │
    │       └─ 否 → 使用实现设计文档模板
    │               (Oracle)
    │
    └─ 否 → 需要参考规范？
            │
            ├─ 编写伪代码 → 伪代码规范
            ├─ 编写代码 → 代码规范
            └─ 维护文档 → 文档规范
```

---

## 版本历史

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v5.6 | 2026-02-07 | 重构为渐进式披露结构 |
| v5.5 | 2026-02-07 | 增加 Prometheus 角色，区分架构与实现设计 |
| v5.4 | 2026-02-07 | 增加 Supervisor 角色 |
| v5.3 | 2026-02-07 | 初始版本 |

---

👉 [返回 L3: 工作流规范](../03_workflow/index.md)  
👉 [返回 L1: 核心概念](../01_concept_overview.md)
