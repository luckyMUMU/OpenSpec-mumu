---
version: v2.7.0
updated: 2026-02-23
---

# Spec 设计阶段交互式提问指南

## 概述

本文档整合 Spec 设计阶段（L2/L3）的交互式提问机制，确保设计决策与现有架构、ADR、约束矩阵保持一致。核心决策依据：[ADR-Spec-004](../04_context_reference/adr_Spec_004_interactive_questioning.md)。

适用于 `sop-architecture-design` 和 `sop-implementation-designer` 在设计过程中与用户的交互场景。

---

## 提问触发机制

### 检测时机

| 设计阶段 | 检测节点 | 触发条件 |
|----------|----------|----------|
| L2 架构设计 | 技术选型章节 | 引入新依赖/框架/服务 |
| L2 架构设计 | 接口定义章节 | 定义跨模块接口/公共 API |
| L2 架构设计 | 数据流章节 | 涉及数据存储/传输变更 |
| L3 实现设计 | 技术规格章节 | 具体技术实现方案选择 |
| L3 实现设计 | 接口契约章节 | 函数签名/数据结构定义 |

### 检测范围

| 范围 | 路径 | 处理规则 |
|------|------|----------|
| ADR 文档 | `docs/04_context_reference/adr_*.md` | 已接受→强制合规；提议中→确认一致性；废弃→检查是否重新激活 |
| 设计文档 | `docs/02_logical_workflow/*.md` | 架构边界定义、模块职责划分 |
| 约束矩阵 | `docs/05_constraints/*.md` | 安全红线、性能基线、兼容性要求 |

---

## 冲突优先级处理

### 优先级定义

| 优先级 | 影响范围 | 冲突类型 | 处理时限 |
|--------|----------|----------|----------|
| P0 | 系统级 | 安全红线/数据丢失风险 | 立即阻断 |
| P1 | 模块级 | 架构边界/接口兼容性 | 当前章节完成前 |
| P2 | 功能级 | 性能/可维护性影响 | 设计阶段结束前 |
| P3 | 代码级 | 实现细节/风格问题 | 可延后至实现阶段 |

### 冲突类型

| 类型 | 说明 | 示例 |
|------|------|------|
| 直接矛盾 | 新设计与 ADR 决策直接相反 | 技术栈冲突、禁止实践 |
| 隐含矛盾 | 隐含违反 ADR 约束 | 性能不达标、安全隐患 |
| 过时引用 | 引用已废弃的决策 | 废弃技术选型、已删除模块 |

---

## 提问格式规范

### 结构化提问模板

```markdown
## 设计确认请求

### 检测到的冲突/问题
**类型**: [冲突类型]
**位置**: [设计文档章节]
**描述**: [具体问题描述]

### 相关约束/决策
> 引用: [ADR-XXX](../04_context_reference/adr_xxx.md) 或 [约束文档](../05_constraints/xxx.md)
> 要求: [约束/决策的具体要求]

### 当前设计内容
[展示当前设计的相关部分]

### 请选择处理方式
- **A. [方案名称]**: [方案描述]
  - 影响: [对现有系统的影响]
  - 风险: [潜在风险]
  
- **B. [方案名称]**: [方案描述]
  - 影响: [对现有系统的影响]
  - 风险: [潜在风险]
  
- **C. 自定义方案**: 请描述您的方案

**推荐**: [A/B] (理由: [推荐理由])
```

### 选项设计原则

| 原则 | 说明 |
|------|------|
| 完整性 | 选项应覆盖主要可行方案 |
| 互斥性 | 各选项之间应相互独立 |
| 可比较性 | 选项应使用相同的评估维度 |
| 可操作性 | 每个选项应可直接执行 |
| 默认推荐 | 提供基于最佳实践的推荐 |

---

## ADR 确认更新机制

### 更新确认模板

```markdown
## ADR 更新确认

### 目标 ADR
**文档**: [ADR-XXX: 标题](../04_context_reference/adr_xxx.md)
**当前状态**: [已接受/提议中]

### 变更预览
| 章节 | 变更前 | 变更后 |
|------|--------|--------|
| [章节名] | [原内容] | [新内容] |

### 影响评估
- **影响范围**: [受影响的模块/系统]
- **兼容性**: [是否向后兼容]
- **迁移成本**: [需要的迁移工作]

### 请确认
- **确认更新**: 同意更新 ADR，继续设计
- **拒绝更新**: 保持原 ADR，调整设计方案
- **创建新 ADR**: 保留原 ADR，创建新 ADR 记录此决策
```

### 用户响应处理

| 用户响应 | 处理动作 | 后续步骤 |
|----------|----------|----------|
| 确认更新 | 更新 ADR 文档 | 继续设计，记录变更日志 |
| 拒绝更新 | 回滚设计变更 | 重新设计方案以符合现有 ADR |
| 创建新 ADR | 创建新 ADR 文档 | 新 ADR 引用原 ADR，说明替代关系 |
| 请求讨论 | 暂停设计流程 | 进入讨论模式，记录讨论结论 |

---

## 检查清单快速参考

### 六维度检查表

| 维度 | 检查项 | 结论 |
|------|--------|------|
| **架构一致性** | 是否符合现有架构分层？模块边界是否清晰？依赖方向是否正确？是否引入跨层调用？ | ✅/⚠️/❌ |
| **ADR 合规性** | 是否与已接受 ADR 冲突？是否需更新/创建 ADR？是否复用废弃 ADR 场景？ | ✅/⚠️/❌ |
| **性能影响** | 是否影响关键路径？是否引入性能瓶颈？数据量增长影响？ | ✅/⚠️/❌ |
| **安全风险** | 是否涉及敏感数据？是否引入攻击面？权限控制是否完备？ | ✅/⚠️/❌ |
| **可维护性** | 代码复杂度是否可控？是否便于测试和扩展？文档是否完整？ | ✅/⚠️/❌ |
| **兼容性** | 是否影响现有接口？是否需要数据迁移？版本升级策略是否明确？ | ✅/⚠️/❌ |

### 检查结果处理

| 结论 | 处理方式 |
|------|----------|
| ✅ 通过 | 记录结论，继续后续流程 |
| ⚠️ 待定 | 标记待确认项，明确确认责任人和时间 |
| ❌ 需处理 | 制定具体处理计划，跟踪处理进度 |

---

## 约束

1. **即时提问**：检测到冲突时必须立即提问，不得延后
2. **结构化选项**：提问必须提供结构化选项，不得仅开放问答
3. **证据引用**：提问必须引用相关 ADR/约束文档作为依据
4. **分级记录**：所有用户决策必须按分级标准记录
5. **检查清单**：每个设计章节完成后必须执行检查清单
6. **优先级遵守**：多冲突时必须按优先级顺序处理

---

## 相关文档引用

| 文档 | 用途 |
|------|------|
| [ADR-Spec-004: 交互式提问机制](../04_context_reference/adr_Spec_004_interactive_questioning.md) | 核心决策依据 |
| [ADR 模板](document_templates/adr.md) | ADR 文档格式参考 |
| [设计指南](design_guide.md) | design.md 创建与执行指南 |
| [约束矩阵](../05_constraints/constraint_matrix.md) | 约束验证参考 |
