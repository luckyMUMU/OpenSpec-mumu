# 约束规范

> **版本**: v1.5.0  
> **更新日期**: 2026-02-11

---

## 概述

本文档目录定义 SOP 流程中的**约束规范**，使用**黑白名单**方式明确各角色、各阶段的允许操作和禁止操作。

---

## 文档列表

| 文档 | 说明 | 适用对象 |
|------|------|----------|
| [禁止项矩阵](constraint_matrix.md) | 完整的黑白名单定义，包含角色、阶段、文件类型的禁止项 | 所有角色 |
| [状态字典](state_dictionary.md) | 状态标记的唯一来源（停止点/目录状态/熔断状态） | 所有角色 |
| [安全与供应链红线](security_supply_chain.md) | 安全边界与依赖治理的硬性要求 | 所有角色 |

---

## 核心约束速查

### 五大核心约束

| 约束 | 说明 | 违反后果 |
|------|------|----------|
| **先标记状态** | 先标记`[DIR_WORKING]`，再执行操作 | 状态混乱 |
| **父目录摘要** | 父目录只保留摘要+链接 | 破坏渐进披露 |
| **各角色权限** | 只操作授权范围内的文件 | 权限混乱 |
| **先复用** | 先复用→改进→新建→清理 | 重复造轮子 |
| **测试独立** | 测试用例与代码分离 | 测试偏见 |

### 关键禁止项

#### 全局禁止
- ❌ 未标记状态直接修改文件
- ❌ 非Librarian修改`/docs/参考/`
- ❌ 跳过必要的审查阶段
- ❌ 绕过停止点继续
- ❌ 提交密钥/敏感信息、关闭安全校验（见 security_supply_chain.md）

#### 角色特定禁止
- ❌ **Explorer**: 修改任何代码（只读角色）
- ❌ **Tester**: 查看代码实现（保持独立）
- ❌ **TestWorker**: 修改CSV（权限隔离）
- ❌ **Worker**: 修改设计内容（按设计实现，仅可追加“待处理变更”）

#### 阶段特定禁止
- ❌ 需求阶段：禁止编码
- ❌ 架构阶段：禁止技术绑定
- ❌ 测试用例阶段：禁止参考代码
- ❌ 编码阶段：禁止偏离设计

---

## 违反后果等级

| 等级 | 违规类型 | 处理方式 |
|------|----------|----------|
| 🟡 **轻微** | 格式不规范、链接未更新 | 提醒修正 |
| 🟠 **中度** | 跳过停止点、未标记状态 | 阻止操作 |
| 🔴 **严重** | 修改SOP、破坏测试独立、3次失败 | **熔断** |

---

## 使用方式

### 对于 AI Agent

1. **执行任务前**：检查本角色的禁止项
2. **操作文件前**：确认文件类型的权限
3. **遇到约束冲突**：停止并报告

### 对于人类用户

1. **分配任务时**：确认选择了正确的角色
2. **审查时**：对照禁止项检查
3. **熔断时**：查看违反的约束类型

---

## 相关文档

- [角色矩阵](../02_role_matrix/index.md) - 完整角色定义
- [工作流规范](../03_workflow/index.md) - 路径选择
- [快速参考](../ROLE_CHEATSHEET.md) - 速查表

---

**注意**: 约束规范是 SOP 流程的保障机制。所有角色必须遵守，违反将触发相应的处理机制。
