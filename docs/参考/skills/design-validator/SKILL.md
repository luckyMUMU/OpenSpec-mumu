---
name: "design-validator"
description: "验证 design.md 完成情况，确保代码实现与设计文档一致。Invoke after implementation is complete, before marking tasks as done, or when archiving design documents."
---

# Design Validator Skill

验证 design.md 完成情况，确保代码实现与设计文档一致。

## 使用场景

- Worker 完成代码实现后
- 标记任务为 `[已完成]` 前
- 归档 design.md 前
- 需要验证实现与设计一致性时

## 工作流程

### Step 1: 读取设计文档

```rust
Read(file_path: "src/module/design.md")
```

### Step 2: 读取实现代码

根据设计文档中的接口契约，读取对应实现：

```rust
Read(file_path: "src/module/implementation.rs")
```

### Step 3: 对比验证

| 验证项 | 检查内容 |
|--------|----------|
| 接口一致性 | 实现是否符合接口契约 |
| 功能完整性 | 是否实现了所有任务清单项 |
| 命名规范 | 是否符合命名约定 |
| 测试覆盖 | 是否达到设计中的测试策略 |

### Step 4: 生成验证报告

```markdown
## 验证报告

### 验证项
- [x] 接口一致性
- [x] 功能完整性
- [x] 命名规范
- [x] 测试覆盖

### 结果
[通过/不通过]

### 差异项
[如有差异，列出详情]

### 建议
[改进建议]
```

### Step 5: 归档或修正

- **通过**: 更新状态为 `[已完成]`，归档到历史记录
- **不通过**: 返回给 Worker 修正

## 输入格式

```markdown
## 验证目标
[design.md 路径]

## 实现代码
[主要实现文件路径]

## 验证范围
[全部/特定任务]
```

## 输出格式

```markdown
## 验证报告

### 设计文档
[design.md 路径]

### 实现代码
[代码文件路径]

### 验证结果
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 接口一致性 | [✅/❌] | [说明] |
| 功能完整性 | [✅/❌] | [说明] |
| 命名规范 | [✅/❌] | [说明] |
| 测试覆盖 | [✅/❌] | [说明] |

### 总体结果
[通过/不通过]

### 下一步
[归档/修正]
```

## 示例

### 验证重试机制实现

**输入**:
```markdown
## 验证目标
src/workflow/executor/design.md

## 实现代码
src/workflow/executor/retry.rs

## 验证范围
全部任务
```

**输出**:
```markdown
## 验证报告

### 设计文档
src/workflow/executor/design.md

### 实现代码
src/workflow/executor/retry.rs

### 验证结果
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 接口一致性 | ✅ | 完全匹配接口契约 |
| 功能完整性 | ✅ | 所有任务已实现 |
| 命名规范 | ✅ | 符合 Rust 命名规范 |
| 测试覆盖 | ✅ | 15/15 测试通过 |

### 总体结果
✅ 通过

### 下一步
@Librarian: 请归档 design.md，更新状态为 `[已完成]`
```

### 验证不通过示例

**输出**:
```markdown
## 验证报告

### 验证结果
| 检查项 | 状态 | 说明 |
|--------|------|------|
| 接口一致性 | ❌ | 缺少 `max_retries` 参数 |
| 功能完整性 | ⚠️ | Task 3 未实现 |
| 命名规范 | ✅ | 符合规范 |
| 测试覆盖 | ❌ | 仅 60% 覆盖 |

### 总体结果
❌ 不通过

### 差异项
1. 接口缺少 `max_retries` 参数
2. Task 3 (指数退避) 未实现
3. 测试覆盖率不足

### 建议
@Worker: 请补充缺失功能，提高测试覆盖率
```

## 归档流程

验证通过后，执行归档：

```markdown
## 3. 状态记录
- `[已完成]` | 重试机制实现 | 2026-02-05
  - Task 0: 渐进式重构 ✅
  - Task 1: Trait 实现 ✅
  - Task 2: 策略实现 ✅
  - Task 3: 指数退避 ✅
```

## 约束

- 必须对比接口契约和实际实现
- 必须检查所有任务清单项
- 测试覆盖率必须达到设计要求
- 不通过时必须明确差异项
